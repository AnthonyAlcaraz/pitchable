<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: Inter, -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 13px;
      color: #333;
      padding: 16px;
      background: #fff;
    }
    h2 { font-size: 15px; font-weight: 600; margin-bottom: 12px; }
    label { display: block; font-weight: 500; margin-bottom: 4px; color: #555; }
    input {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
      margin-bottom: 12px;
      outline: none;
      transition: border-color 0.15s;
    }
    input:focus { border-color: #4f46e5; }
    button {
      width: 100%;
      padding: 10px;
      background: #4f46e5;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s;
    }
    button:hover { background: #4338ca; }
    button:disabled { background: #a5b4fc; cursor: not-allowed; }
    .status {
      margin-top: 12px;
      padding: 8px 10px;
      border-radius: 6px;
      font-size: 12px;
      display: none;
    }
    .status.info { display: block; background: #eff6ff; color: #1e40af; border: 1px solid #bfdbfe; }
    .status.error { display: block; background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
    .status.success { display: block; background: #f0fdf4; color: #166534; border: 1px solid #bbf7d0; }
    .progress { margin-top: 8px; font-size: 12px; color: #6b7280; }
    .help { margin-top: 16px; font-size: 11px; color: #9ca3af; line-height: 1.5; }
  </style>
</head>
<body>
  <h2>Import from Pitchable</h2>

  <label for="apiUrl">API URL</label>
  <input id="apiUrl" type="url" placeholder="https://api.pitchable.app" value="http://localhost:3001">

  <label for="apiKey">API Key</label>
  <input id="apiKey" type="password" placeholder="Your Pitchable API key">

  <label for="presentationId">Presentation ID</label>
  <input id="presentationId" type="text" placeholder="e.g. a1b2c3d4-...">

  <button id="importBtn" onclick="startImport()">Import Presentation</button>

  <div id="status" class="status"></div>
  <div id="progress" class="progress"></div>

  <div class="help">
    Get your API key from Pitchable Settings &gt; API Keys.<br>
    The presentation ID is in the URL: /presentations/<strong>{id}</strong>
  </div>

  <script>
    const statusEl = document.getElementById('status');
    const progressEl = document.getElementById('progress');
    const importBtn = document.getElementById('importBtn');

    function setStatus(msg, type) {
      statusEl.textContent = msg;
      statusEl.className = 'status ' + type;
    }

    function startImport() {
      const apiUrl = document.getElementById('apiUrl').value.trim().replace(/\/$/, '');
      const apiKey = document.getElementById('apiKey').value.trim();
      const presentationId = document.getElementById('presentationId').value.trim();

      if (!apiUrl || !apiKey || !presentationId) {
        setStatus('Please fill in all fields.', 'error');
        return;
      }

      importBtn.disabled = true;
      setStatus('Creating export job...', 'info');

      parent.postMessage({
        pluginMessage: {
          type: 'import',
          apiUrl,
          apiKey,
          presentationId,
        }
      }, '*');
    }

    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (!msg) return;

      switch (msg.type) {
        case 'progress':
          progressEl.textContent = msg.text;
          break;
        case 'error':
          setStatus(msg.text, 'error');
          importBtn.disabled = false;
          progressEl.textContent = '';
          break;
        case 'success':
          setStatus(msg.text, 'success');
          importBtn.disabled = false;
          progressEl.textContent = '';
          break;
      }
    };
  </script>
</body>
</html>
